<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Cognitive Resonance</title>
  <link rel="stylesheet" href="/styles/main.css">
</head>

<body>
  <div class="bg-gradient"></div>
  <div class="bg-noise"></div>

  <header class="paper-header">
    <div class="container">
      <a href="/" aria-label="Go to homepage">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
        Home
      </a>
      <nav>
        <a href="/index.html#papers">Papers</a>
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">ðŸŒ™</button>
      </nav>
    </div>
    <div class="paper-progress-container">
      <div id="paper-progress-bar"></div>
    </div>
  </header>

  <main class="paper-main">
    <div class="paper-verification">
      <div class="verification-dot"></div>
      <span class="verification-text">Verified Experiment â€¢ COG-RESONANCE</span>
    </div>
    <h1>Cognitive Resonance Cascade</h1>
    <div id="content">Loading...</div>
  </main>

  <script src="/scripts/futuristic-charts.js" defer></script>
  <script src="/scripts/theme.js" defer></script>
  <script>
    function loadScript(src) {
      return new Promise((res, rej) => {
        const s = document.createElement('script');
        s.src = src;
        s.onload = res;
        s.onerror = () => rej(new Error('Failed to load ' + src));
        document.head.appendChild(s);
      });
    }
    function ensureMarked() {
      if (window.marked) return Promise.resolve();
      return loadScript('/scripts/marked.min.js').then(() => {
        if (window.marked) return;
        return loadScript('https://cdn.jsdelivr.net/npm/marked/marked.min.js');
      });
    }

    fetch('Cognitive Resonance Cascade.md')
      .then(r => r.text())
      .then(md => {
        const sanitized = md.replace(/!\[[^\]]*\]\([^\)]+\)/g, () => '\n<div data-fchart></div>\n');
        return ensureMarked().then(() => ({ sanitized }));
      })
      .then(({ sanitized }) => {
        const html = (marked.parse ? marked.parse(sanitized) : marked(sanitized));
        document.getElementById('content').innerHTML = html;
        if (window.renderFuturisticCharts) window.renderFuturisticCharts(document.getElementById('content'));
        window.dispatchEvent(new Event('scroll'));
      })
      .catch(err => { console.error('Failed to load paper:', err); document.getElementById('content').textContent = 'Failed to load paper.'; });

    window.addEventListener('scroll', () => {
      const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (winScroll / height) * 100;
      const bar = document.getElementById('paper-progress-bar');
      if (bar) bar.style.width = scrolled + '%';
    });
  </script>
</body>

</html>