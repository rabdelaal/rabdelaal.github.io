<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Cognitive Resonance Cascade</title>
    <link rel="stylesheet" href="/styles/main.min.css">
  </head>
  <body>
  <header class="paper-header">
    <div class="container">
      <a href="/" aria-label="Go to homepage">← Home</a>
      <nav>
  <a href="/index.html#papers">Papers</a>
  <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme" aria-pressed="false" title="Toggle theme">🌙</button>
      </nav>
    </div>
  </header>
  <main class="paper-main">
      <h1>Cognitive Resonance Cascade</h1>
      <div id="content">Loading...</div>
    </main>
  <script src="/scripts/futuristic-charts.js" defer></script>
  <script src="/scripts/theme.js" defer></script>
    <script>
      function loadScript(src){
        return new Promise((res, rej)=>{
          const s = document.createElement('script');
          s.src = src;
          s.onload = res;
          s.onerror = () => rej(new Error('Failed to load '+src));
          document.head.appendChild(s);
        });
      }
      function ensureMarked(){
        if(window.marked) return Promise.resolve();
        return loadScript('/scripts/marked.min.js').then(() => {
          if (window.marked) return;
          return loadScript('https://cdn.jsdelivr.net/npm/marked/marked.min.js');
        });
      }

      fetch('Cognitive Resonance Cascade.md')
        .then(r=>r.text())
        .then(md=>{
            const sanitized = md.replace(/!\[[^\]]*\]\([^\)]+\)/g, ()=>'\n<div data-fchart></div>\n');
            return ensureMarked().then(()=>({ sanitized }));
        })
        .then(({ sanitized })=>{
            const html = (marked.parse?marked.parse(sanitized):marked(sanitized));
            document.getElementById('content').innerHTML = html;
            if(window.renderFuturisticCharts) window.renderFuturisticCharts(document.getElementById('content'));
        })
        .catch(err => { console.error('Failed to load paper:', err); document.getElementById('content').textContent = 'Failed to load paper.'; });
    </script>
  </body>
</html>
