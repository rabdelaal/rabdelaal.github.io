<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Cognitive Resonance</title>
  <link rel="stylesheet" href="/styles/main.css">
</head>

<body>
  <div class="bg-gradient"></div>
  <div class="bg-noise"></div>

  <header class="paper-header">
    <div class="container">
      <a href="/" aria-label="Go to homepage">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
        Home
      </a>
      <nav>
        <a href="/index.html#papers">Papers</a>
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">ðŸŒ™</button>
      </nav>
    </div>
    <div class="paper-progress-container">
      <div id="paper-progress-bar"></div>
    </div>
  </header>

  <main class="paper-main">
    <div class="paper-sheet">
      <div class="paper-verification">
        <div class="verification-dot"></div>
        <span class="verification-text">Verified Experiment â€¢ COG-RESONANCE</span>
      </div>

      <div class="paper-metadata">
        <div class="paper-metadata-grid">
          <div class="metadata-item">
            <span class="metadata-label">Author</span>
            <span class="metadata-value">Romain Abdel-Aal</span>
          </div>
          <div class="metadata-item">
            <span class="metadata-label">Date</span>
            <span class="metadata-value">2026</span>
          </div>
          <div class="metadata-item">
            <span class="metadata-label">Category</span>
            <span class="metadata-value">Neural Resonance / AI Ethics</span>
          </div>
          <div class="metadata-item">
            <span class="metadata-label">Status</span>
            <span class="metadata-value" style="color: #22c55e;">Experiment Validated</span>
          </div>
        </div>
      </div>

      <div id="content">Loading paper content...</div>
    </div>
  </main>

  <script src="/scripts/futuristic-charts.js" defer></script>
  <script src="/scripts/theme.js" defer></script>
  <script src="/scripts/playgrounds.js" defer></script>
  <script>
    function loadScript(src) {
      return new Promise((res, rej) => {
        const s = document.createElement('script');
        s.src = src;
        s.onload = res;
        s.onerror = () => rej(new Error('Failed to load ' + src));
        document.head.appendChild(s);
      });
    }
    function ensureMarked() {
      if (window.marked) return Promise.resolve();
      return loadScript('/scripts/marked.min.js').then(() => {
        if (window.marked) return;
        return loadScript('https://cdn.jsdelivr.net/npm/marked/marked.min.js');
      });
    }

    fetch('Cognitive Resonance Cascade.md')
      .then(r => r.text())
      .then(md => {
        const sanitized = md.replace(/!\[[^\]]*\]\([^\)]+\)/g, () => '\n<div data-fchart></div>\n');
        return ensureMarked().then(() => ({ sanitized }));
      })
      .then(({ sanitized }) => {
        const html = (marked.parse ? marked.parse(sanitized) : marked(sanitized));
        document.getElementById('content').innerHTML = `
          <div id="cogni-playground"></div>
          <hr style="margin: var(--space-2xl) 0; border: 0; border-top: 1px solid var(--border-subtle);">
          ${html}
        `;

        // Promote first H3 title to H1
        const firstH3 = document.querySelector('#content h3');
        if (firstH3) {
          const h1 = document.createElement('h1');
          h1.innerHTML = firstH3.innerHTML;
          firstH3.parentNode.replaceChild(h1, firstH3);
        }

        if (window.renderFuturisticCharts) window.renderFuturisticCharts(document.getElementById('content'));
        if (window.initPlayground) window.initPlayground('cognitive-resonance', 'cogni-playground');
        window.dispatchEvent(new Event('scroll'));
      })
      .catch(err => { console.error('Failed to load paper:', err); document.getElementById('content').textContent = 'Failed to load paper.'; });

    window.addEventListener('scroll', () => {
      const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (winScroll / height) * 100;
      const bar = document.getElementById('paper-progress-bar');
      if (bar) bar.style.width = scrolled + '%';
    });
  </script>
</body>

</html>